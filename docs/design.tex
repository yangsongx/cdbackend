\documentclass{beamer}
\usetheme{Madrid}
%\usetheme{Hannover}
\usepackage{fontspec,xunicode,xltxtra,xecolor,listings,color}
\usepackage{bchart}
\usepackage{tikz}
\usetikzlibrary{arrows,shapes,trees,calc,automata,positioning}
\tikzset{
  mybox/.style={
    rectangle,
    rounded corners,
    draw=black
  },
}

\setmainfont{WenQuanYi Micro Hei}
\setsansfont{WenQuanYi Micro Hei}
\setmonofont{WenQuanYi Micro Hei}
\XeTeXlinebreaklocale "zh"
\XeTeXlinebreakskip=0pt plus 1pt minus 0.1pt

\begin{document}

\defverbatim[colored]\apicode{%
  \begin{lstlisting}[basicstyle=\tiny,language=java,frame=lines,showspaces=false,emphstyle=\color{blue}]
import com.caredear.common.util.CdRecycleUsrData;

int CdRecycleUsrData.saveDeletedContactData(String deleted_contact);
int CdRecycleUsrData.restoreDeletedContactData(Context context);
\end{lstlisting}
}

\title{亲连服务器开发设计文档}
\institute{CearDear Service Team}
\frame{\titlepage}

\begin{frame}
\frametitle{Outline}
\tableofcontents
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{新用户注册设计}

%  ######################
\begin{frame}
\frametitle{申请Token}


\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{网盘设计}

%  ######################
\begin{frame}[fragile]
\frametitle{上传文件}

\begin{tikzpicture}
% the input from APK
\node [mybox] (ID1) {\begin{lstlisting}[frame=none,basicstyle=\tiny]
{
  "user":"130xxxxxxxx",
  "filename":"abc.png",
  "md5":xxxxxxx
}
                     \end{lstlisting}
};

\node [mybox, right of = ID1, xshift=4cm] (IDWeb) {\begin{lstlisting}
(Web)
                       \end{lstlisting}
};

\draw [->, thick] (IDWeb) -- (ID1);
\end{tikzpicture}
\end{frame}


%  ######################
\begin{frame}
\frametitle{下载文件}

\end{frame}


%  ######################
\begin{frame}
\frametitle{删除文件}

\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Debug and Tips}

%  ######################
\begin{frame}
\frametitle{调试}
  \framesubtitle{运行情况}
\begin{tikzpicture}
\node [mybox] (ID21k) {21k-code};
\node [mybox, right of = ID21k, xshift=2.8cm] (IDksadmin) {ksadmin};
\node [mybox, right of = IDksadmin, xshift=2.9cm, yshift=1.5cm] (IDksapp1) {ksapp1};
\node [mybox, right of = IDksadmin, xshift=2.9cm, yshift=-1.5cm] (IDksapp3) {ksapp3};
% arrow
\draw [->] (IDksadmin) -- (IDksapp1) node [pos=.4,above,font=\footnotesize,color=orange, sloped] {ksapp1};
\draw [->] (IDksadmin) -- (IDksapp3) node [pos=.4,above,font=\footnotesize,color=orange, sloped] {ksapp3};
\draw [->] (ID21k) -- (IDksadmin) node [pos=.5,above,font=\footnotesize,color=orange] {ksadmin};
\node [green!90, above] at (IDksapp1.north) {UserCenter,Web前端};
\node [green!90, above] at (IDksapp3.north) {Token验证服务器};
\end{tikzpicture}

服务端口分配:
\bgroup
\def\arraystretch{1.15} 
\begin{tabular}{|c|c|}
{服务名称} & {端口号}\\
        \hline
{注册Token} & {11999(暂定)}  \\
{Token验证(tauth)} & {12000}  \\
{网盘服务} & {12001} \\
\end{tabular}
\egroup
\end{frame}

%  ######################
\begin{frame}
\frametitle{调试}
  \framesubtitle{Log文件位置}
\begin{tikzpicture}
\node [mybox] (ID21k) {21k-code};
\node [mybox, right of = ID21k, xshift=1.0cm] (IDksadmin) {ksadmin};
\node [mybox, right of = IDksadmin, xshift=2.5cm, yshift=1.5cm] (IDksapp1) {ksapp1};
\node [mybox, right of = IDksadmin, xshift=2.5cm, yshift=-1.5cm] (IDksapp3) {ksapp3};
% arrow
\draw [->] (IDksadmin) -- (IDksapp1);
\draw [->] (IDksadmin) -- (IDksapp3);
\draw [->] (ID21k) -- (IDksadmin);
\node [green!90, above] at (IDksapp1.north) {UserCenter,Web前端};
\node [green!90, above] at (IDksapp3.north) {Token验证服务器};
\node [blue!90, right, font=\scriptsize] at (IDksapp1.east) {/opt/usercenter/logs/application.log};
\node [blue!90, right, font=\scriptsize] at (IDksapp3.east) {/home/tokenverify/nohup.out};
\end{tikzpicture}

\end{frame}

%  ######################
\begin{frame}
\frametitle{调试}
  \framesubtitle{交换文件命令}
\begin{tikzpicture}
\node [mybox] (ID21k) {21k-code};
\node [mybox, right of = ID21k, xshift=1.0cm] (IDksadmin) {ksadmin};
\node [mybox, right of = IDksadmin, xshift=2.5cm, yshift=1.5cm] (IDksapp1) {ksapp1};
\node [mybox, right of = IDksadmin, xshift=2.5cm, yshift=-1.5cm] (IDksapp3) {ksapp3};
% arrow
\draw [->, thick] (IDksadmin) -- (IDksapp1);
\draw [->] (IDksadmin) -- (IDksapp3);
\draw [->] (ID21k) -- (IDksadmin);
\node [green!90, above] at (IDksapp1.north) {UserCenter,Web前端};
\node [green!90, above] at (IDksapp3.north) {Token验证服务器};
\node [blue!90, right, font=\scriptsize] at (IDksapp1.east) {/opt/usercenter/logs/application.log};
\node [blue!90, right, font=\scriptsize] at (IDksapp3.east) {/home/tokenverify/nohup.out};
\end{tikzpicture}

\end{frame}
%  ######################
\begin{frame}
\frametitle{调试}
  \framesubtitle{运算Token}
  use openssl command and base64 command

\end{frame}


\end{document}
